<div class="dashboard-container" [ngClass]="{ 'dark-mode': isDarkMode }">

  <!-- Sidebar -->
  <div class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <h2 class="logo">Dashboard</h2>
    </div>

    <nav class="sidebar-nav">
      <ul>

        <li class="nav-item" [class.active]="activeSection === 'home'" (click)="setActiveSection('home')">
          <i class="pi pi-home icon"></i>
          <span>Home</span>
        </li>

        <li class="nav-item" [class.active]="activeSection === 'analytics'" (click)="setActiveSection('analytics')">
          <i class="pi pi-chart-bar icon"></i>
          <span>Analytics</span>
        </li>

        <!-- USERS MENU -->
        <li class="nav-item" [class.active]="activeSection === 'users'" (click)="toggleUserDropdown()"
            *ngIf="!userDropdownOpen">
          <i class="pi pi-users icon"></i>
          <span>Users</span>
          <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 9l-7 7-7-7"></path>
          </svg>
        </li>

        <li class="nav-item active-dropdown" *ngIf="userDropdownOpen">
          <i class="pi pi-users icon"></i>
          <span>Users</span>
          <svg class="dropdown-arrow rotated" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 9l-7 7-7-7"></path>
          </svg>
        </li>

        <div class="dropdown-menu" *ngIf="userDropdownOpen">
          <div class="dropdown-item" [class.active]="activeSection === 'users' && !showAddUserForm"
               (click)="setActiveSection('users'); hideAddUser()">
            <i class="pi pi-eye"></i>
            <span>View Assyers</span>
          </div>

          <div class="dropdown-item" [class.active]="showAddUserForm" (click)="showAddUser()">
            <i class="pi pi-user-plus"></i>
            <span>Add Assyers</span>
          </div>
        </div>

        <!-- CLIENTS MENU -->
        <li class="nav-item" [class.active]="activeSection === 'clients'" (click)="setActiveSection('clients')">
          <i class="pi pi-briefcase icon"></i>
          <span>Clients</span>
        </li>

        <!-- LISTS MENU -->
        <li class="nav-item" [class.active]="activeSection === 'lists'" (click)="toggleListDropdown()"
            *ngIf="!listDropdownOpen">
          <i class="pi pi-list icon"></i>
          <span>Lists</span>
          <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 9l-7 7-7-7"></path>
          </svg>
        </li>

        <li class="nav-item active-dropdown" *ngIf="listDropdownOpen">
          <i class="pi pi-list icon"></i>
          <span>Lists</span>
          <svg class="dropdown-arrow rotated" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 9l-7 7-7-7"></path>
          </svg>
        </li>

        <div class="dropdown-menu" *ngIf="listDropdownOpen">
          <div class="dropdown-item" (click)="goToProcurement()">
            <i class="pi pi-shopping-cart"></i>
            <span>Procurement List</span>
          </div>

          <div class="dropdown-item" (click)="goToFarmers()">
            <i class="pi pi-users"></i>
            <span>Farmer List</span>
          </div>
        </div>

        <li class="nav-item" [class.active]="activeSection === 'settings'" (click)="setActiveSection('settings')">
          <i class="pi pi-cog icon"></i>
          <span>Settings</span>
        </li>

        <li class="nav-item" [class.active]="activeSection === 'reports'" (click)="setActiveSection('reports')">
          <i class="pi pi-file icon"></i>
          <span>Reports</span>
        </li>

      </ul>
    </nav>

    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <i class="pi pi-sign-out icon"></i>
        <span>Logout</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">

    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleSidebar()">
          <span></span>
          <span></span>
          <span></span>
        </button>

        <h1 class="page-title">Welcome to Dashboard</h1>
      </div>

      <div class="header-right">

        <!-- Theme Toggle Button -->
        <div class="theme-toggle">
          <button type="button" class="theme-btn" (click)="toggleTheme()">
            <i class="pi" [ngClass]="isDarkMode ? 'pi-sun' : 'pi-moon'"></i>
            <span>{{ isDarkMode ? 'Light' : 'Dark' }}</span>
          </button>
        </div>

        <div class="user-info">
          <div class="user-avatar">
            <i class="pi pi-users"></i>
          </div>
          <span class="user-name">User</span>
        </div>

      </div>
    </header>

    <!-- Content Area -->
    <main class="content">

      <!-- HOME -->
      <div *ngIf="activeSection === 'home'" class="welcome-section">
        <div class="welcome-card">
          <h2>ðŸŽ‰ Welcome Back!</h2>
          <p>You have successfully logged in to your dashboard.</p>

          <div class="stats-grid">
            <div class="stat-card">
              <i class="pi pi-users"></i>
              <div class="stat-info">
                <h3>1,234</h3>
                <p>Total Users</p>
              </div>
            </div>

            <div class="stat-card">
              <i class="pi pi-wallet"></i>
              <div class="stat-info">
                <h3>$12,345</h3>
                <p>Revenue</p>
              </div>
            </div>

            <div class="stat-card">
              <i class="pi pi-chart-line"></i>
              <div class="stat-info">
                <h3>89%</h3>
                <p>Success Rate</p>
              </div>
            </div>

            <div class="stat-card">
              <i class="pi pi-star-fill"></i>
              <div class="stat-info">
                <h3>4.8</h3>
                <p>Rating</p>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- ================= CLIENTS SECTION ================= -->
      <div *ngIf="activeSection === 'clients'" class="clients-section">

        <div class="section-header">
          <h2><i class="pi pi-briefcase"></i> Add Client</h2>
        </div>

        <!-- âœ… Add Client Form -->
        <div class="add-user-form-card">

          <form [formGroup]="clientForm" (ngSubmit)="submitClient()" class="user-form grid-form">

            <!-- BASIC DETAILS -->
            <div class="form-group">
              <label>Client Name *</label>
              <input type="text" formControlName="name" placeholder="Enter client name" />
            </div>

            <div class="form-group">
              <label>Contact Number *</label>
              <input type="text" formControlName="contactNo" placeholder="Enter contact number" />
            </div>

            <div class="form-group">
              <label>Contact Email</label>
              <input type="email" formControlName="contactEmail" placeholder="Enter email" />
            </div>

            <div class="form-group">
              <label>GSTIN</label>
              <input type="text" formControlName="gstin" placeholder="Enter GSTIN" />
            </div>

            <div class="form-group">
              <label>PAN</label>
              <input type="text" formControlName="pan" placeholder="Enter PAN" />
            </div>

            <!-- ADDRESS TITLE -->
            <h4 class="form-section-title"></h4>

            <div class="form-group">
              <label>Address Line</label>
              <input type="text" formControlName="addrLine" placeholder="Enter address line" />
            </div>

            <div class="form-group">
              <label>Pincode</label>
              <input type="text" formControlName="pincode" placeholder="Enter pincode" />
            </div>

            <div class="form-group">
              <label>State ID</label>
              <input type="number" formControlName="stateId" placeholder="Enter state id" />
            </div>

            <div class="form-group">
              <label>District ID</label>
              <input type="number" formControlName="districtId" placeholder="Enter district id" />
            </div>

            <div class="form-group">
              <label>Sub-District ID</label>
              <input type="number" formControlName="subDistrictId" placeholder="Enter sub-district id" />
            </div>

            <!-- CONTACT PERSON TITLE -->
            <h4 class="form-section-title"></h4>

            <div class="form-group">
              <label>Name</label>
              <input type="text" formControlName="cpName" placeholder="Enter contact person name" />
            </div>

            <div class="form-group">
              <label>Mobile</label>
              <input type="text" formControlName="cpMobile" placeholder="Enter mobile" />
            </div>

            <div class="form-group">
              <label>Email</label>
              <input type="email" formControlName="cpEmail" placeholder="Enter email" />
            </div>

            <!-- ACTIONS -->
            <div class="form-actions full-width">
              <button type="button" class="cancel-btn" (click)="resetClientForm()">
                Cancel
              </button>
              <button type="submit" class="submit-btn">
                Save Client
              </button>
            </div>

          </form>
        </div>

        <!-- âœ… Clients List -->
        <div class="clients-list-card" style="margin-top: 24px;">
          <h3>Existing Clients</h3>

          <div *ngIf="clientsList.length === 0" style="padding: 16px; text-align: center;">
            No clients found. Add a client above to populate the list.
          </div>

          <div *ngIf="clientsList.length > 0" class="clients-table">

            <div class="table-header">
              <div>ID</div>
              <div>Name</div>
              <div>Contact No</div>
              <div>Approval Status</div>
              <div>Active</div>
              <div>Portal Register Date</div>
            </div>

            <div class="table-body">
              <div class="table-row" *ngFor="let client of clientsList">
                <div>{{ client.id }}</div>
                <div>{{ client.name }}</div>
                <div>{{ client.contactNo }}</div>
                <div>{{ client.approvalStatus }}</div>
                <div>{{ client.isActive ? 'Yes' : 'No' }}</div>
                <div>{{ client.portalRegisterDate | date:'short' }}</div>
              </div>
            </div>

          </div>
        </div>

      </div>
      <!-- ================= END CLIENTS SECTION ================= -->


      <!-- USERS -->
      <div *ngIf="activeSection === 'users'" class="users-section">
        <div class="section-header">
          <h2><i class="pi pi-users"></i> User Management</h2>
        </div>

        <!-- Add User Form -->
        <div *ngIf="showAddUserForm" class="add-user-form-card">

          <div class="form-header">
            <h3>Add New User</h3>
            <button class="close-btn" (click)="hideAddUser()">âœ•</button>
          </div>

          <form [formGroup]="addUserForm" (ngSubmit)="onSubmitUser()" class="user-form">

            <div class="form-group">
              <label for="name">Full Name *</label>
              <input type="text" id="name" formControlName="name" placeholder="Enter full name"
                     [class.error]="addUserForm.get('name')?.invalid && addUserForm.get('name')?.touched" />
              <div class="error-msg" *ngIf="addUserForm.get('name')?.invalid && addUserForm.get('name')?.touched">
                Name is required and must be at least 2 characters
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email Address *</label>
              <input type="email" id="email" formControlName="email" placeholder="Enter email address"
                     [class.error]="addUserForm.get('email')?.invalid && addUserForm.get('email')?.touched" />
              <div class="error-msg" *ngIf="addUserForm.get('email')?.invalid && addUserForm.get('email')?.touched">
                Please enter a valid email address
              </div>
            </div>

            <div class="form-group">
              <label for="mobile">Mobile Number *</label>
              <input type="tel" id="mobile" formControlName="mobile" placeholder="Enter 10-digit mobile number"
                     [class.error]="addUserForm.get('mobile')?.invalid && addUserForm.get('mobile')?.touched" />
              <div class="error-msg" *ngIf="addUserForm.get('mobile')?.invalid && addUserForm.get('mobile')?.touched">
                Please enter a valid 10-digit mobile number
              </div>
            </div>

            <div class="form-group">
              <label for="aadhaar">Aadhaar Number *</label>
              <input type="text" id="aadhaar" formControlName="aadhaar"
                     placeholder="Enter 12-digit Aadhaar number"
                     maxlength="12"
                     [class.error]="addUserForm.get('aadhaar')?.invalid && addUserForm.get('aadhaar')?.touched" />
              <div class="error-msg" *ngIf="addUserForm.get('aadhaar')?.invalid && addUserForm.get('aadhaar')?.touched">
                Please enter a valid 12-digit Aadhaar number
              </div>
            </div>

            <div class="form-group">
              <label for="otp">OTP Verification</label>

              <div class="otp-section">
                <input type="text" id="aadhaarOtp" formControlName="aadhaarOtp"
                       placeholder="Enter 6-digit OTP"
                       maxlength="6"
                       [disabled]="!otpSent || otpVerified"
                       [class.error]="addUserForm.get('aadhaarOtp')?.invalid && addUserForm.get('aadhaarOtp')?.touched" />

                <button type="button" class="otp-btn" (click)="sendOtp()"
                        [disabled]="addUserForm.get('aadhaar')?.invalid">
                  {{ otpSent ? 'Re-enter' : 'Send OTP' }}
                </button>

                <button type="button" class="verify-btn" (click)="verifyOtp()"
                        [disabled]="!otpSent || otpVerified || addUserForm.get('aadhaarOtp')?.invalid">
                  {{ otpVerified ? 'Verified âœ“' : 'Verify OTP' }}
                </button>
              </div>

              <div class="error-msg" *ngIf="addUserForm.get('aadhaarOtp')?.invalid && addUserForm.get('aadhaarOtp')?.touched">
                Please enter a valid 6-digit OTP
              </div>

              <div class="otp-status" *ngIf="otpSent && !otpVerified">
                OTP sent to registered mobile number
              </div>

              <div class="otp-status verified" *ngIf="otpVerified">
                âœ“ Aadhaar verified successfully
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="cancel-btn" (click)="hideAddUser()">Cancel</button>
              <button type="submit" class="submit-btn" [disabled]="addUserForm.invalid || !otpVerified">
                Add User
              </button>
            </div>

          </form>
        </div>

        <!-- Users List -->
        <div class="users-list-card" *ngIf="!showAddUserForm">
          <h3>Existing Users</h3>

          <div class="users-table">

            <div class="table-header">
              <div>Name</div>
              <div>Email</div>
              <div>Mobile</div>
              <div>Role</div>
              <div>Actions</div>
            </div>

            <div class="table-body">

              <div *ngIf="usersList.length === 0" style="padding: 16px; text-align: center;">
                No users found âœ… Please add a user.
              </div>

              <div class="table-row" *ngFor="let user of usersList; let i = index">
                <div>{{ user.name }}</div>
                <div>{{ user.email }}</div>
                <div>{{ user.mobile }}</div>

                <div>
                  <span class="role-badge" [ngClass]="user.role === 'admin' ? 'admin' : 'user'">
                    {{ user.role | titlecase }}
                  </span>
                </div>

                <div class="actions">

                  <button class="menu-btn" type="button" (click)="toggleActionMenu(i, $event)">
                    â‹®
                  </button>

                  <div class="action-dropdown" *ngIf="openMenuIndex === i">

                    <button type="button" class="action-item"
                            (click)="viewUser(user); closeActionMenu()">
                      <i class="pi pi-eye"></i>
                      View
                    </button>

                    <button type="button" class="action-item danger"
                            (click)="deleteUser(i); closeActionMenu()">
                      <i class="pi pi-trash"></i>
                      Delete
                    </button>

                  </div>

                </div>
              </div>

            </div>

          </div>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div *ngIf="activeSection === 'analytics'" class="analytics-section">
        <div class="welcome-card">
          <h2><i class="pi pi-chart-bar icon"></i> Analytics Dashboard</h2>
          <p>View detailed analytics and insights here.</p>
          <div class="placeholder-content">
            <div class="chart-placeholder">
              ðŸ“ˆ Charts and graphs will be displayed here
            </div>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div *ngIf="activeSection === 'settings'" class="settings-section">
        <div class="welcome-card">
          <h2><i class="pi pi-cog icon"></i> Settings</h2>
          <p>Configure your application settings here.</p>
          <div class="placeholder-content">
            <div class="settings-placeholder">
              ðŸ”§ Settings options will be displayed here
            </div>
          </div>
        </div>
      </div>

      <!-- REPORTS -->
      <div *ngIf="activeSection === 'reports'" class="reports-section">
        <div class="welcome-card">
          <h2><i class="pi pi-file icon"></i> Reports</h2>
          <p>Generate and view reports here.</p>
          <div class="placeholder-content">
            <div class="reports-placeholder">
              ðŸ“‹ Reports will be displayed here
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="recent-activity">
        <div class="activity-card">
          <h3>Recent Activity</h3>

          <div class="activity-list">
            <div class="activity-item">
              <i class="pi pi-lock"></i>
              <div class="activity-content">
                <p>Successfully logged in</p>
                <span class="activity-time">2 minutes ago</span>
              </div>
            </div>

            <div class="activity-item">
              <i class="pi pi-user-edit"></i>
              <div class="activity-content">
                <p>Profile updated</p>
                <span class="activity-time">1 hour ago</span>
              </div>
            </div>

            <div class="activity-item">
              <i class="pi pi-envelope"></i>
              <div class="activity-content">
                <p>Email verified</p>
                <span class="activity-time">2 hours ago</span>
              </div>
            </div>
          </div>

        </div>
      </div>

    </main>
  </div>

  <!-- âœ… VIEW USER MODAL -->
  <div class="modal-overlay" *ngIf="isViewModalOpen" (click)="closeViewModal()">

    <div class="modal-box" (click)="$event.stopPropagation()">

      <div class="modal-header">
        <h3><i class="pi pi-user"></i> User Details</h3>
        <button class="modal-close" (click)="closeViewModal()">âœ•</button>
      </div>

      <div class="modal-body" *ngIf="selectedUser">

        <div class="modal-row">
          <span class="label">Name:</span>
          <span class="value">{{ selectedUser.name }}</span>
        </div>

        <div class="modal-row">
          <span class="label">Email:</span>
          <span class="value">{{ selectedUser.email }}</span>
        </div>

        <div class="modal-row">
          <span class="label">Mobile:</span>
          <span class="value">{{ selectedUser.mobile }}</span>
        </div>

        <div class="modal-row">
          <span class="label">Aadhaar:</span>
          <span class="value">{{ selectedUser.aadhaar }}</span>
        </div>

        <div class="modal-row">
          <span class="label">Role:</span>
          <span class="value">{{ selectedUser.role | titlecase }}</span>
        </div>

      </div>

      <div class="modal-footer">
        <button class="modal-btn" (click)="closeViewModal()">Close</button>
      </div>

    </div>
  </div>

</div>
